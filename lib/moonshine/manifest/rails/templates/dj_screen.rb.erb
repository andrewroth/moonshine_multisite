#! /usr/bin/ruby

name = "<%= configuration[:code] %>"

# start a screen if it exists
def start_with_check(name)
  unless %x[screen -ls] =~ /\d+\.#{name}/
    puts "Not found, starting."
    system "screen -d -m -S #{name} &"
    sleep 1
  end
end

#start_with_check name
#system screen -S #{name} -X kill"
start_with_check name
system "screen -S #{name} -p 0 -X exec cat" # run something in case nothing is running so kill doesn't close screen
sleep 1
system "screen -S #{name} -p 0 -X kill"
sleep 1
system "screen -S #{name} -p 0 -X exec /etc/screen.d/dj_<%= configuration[:code] %>.sh"
sleep 1
